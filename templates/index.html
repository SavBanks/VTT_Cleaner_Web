<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VTT Cleaner - Ohio State Theme</title>

    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="theme-toggle">
        <label class="switch">
            <input type="checkbox" id="themeSwitch">
            <span class="slider"></span>
        </label>
        <span id="themeLabel">Light Mode</span>
    </div>

    <div class="card">
        
        <!-- ----------  OSU-Themed Header / Logo  ---------- -->
        <div class="logo-container">
            <!-- This is a SAFE OSU-inspired SVG (NOT the copyrighted logo) -->
            <svg width="70" height="70" viewBox="0 0 100 100">
                <rect x="10" y="10" width="80" height="80" rx="15"
                    fill="#BB0000" stroke="#666" stroke-width="4" />
                <text x="50" y="63" font-size="40" font-family="Arial Black"
                    text-anchor="middle" fill="white">
                    OSU
                </text>
            </svg>

            <!-- If you legally have the OSU logo, replace the SVG above with an <img> -->
            <!-- <img src="osulogo.png" class="real-logo"> -->

            <h1>Ohio State VTT Cleaner</h1>
            <p class="subtitle">Caption Cleaning for Medical & Accessibility Standards</p>
        </div>

        <!-- ----------  Upload Section  ---------- -->
        <input type="file" id="file" accept=".vtt" hidden />

        <div id="dropzone">Drag & drop your .vtt file here<br>or click to choose</div>

        <button id="cleanBtn">Clean Transcript</button>

        <!-- ----------  Status Messages  ---------- -->
        <div id="status" class="status"></div>
        <div id="loading" class="loading" style="display:none;">Cleaning captions… please wait.</div>

    </div>

    <!-- ----------  JavaScript  ---------- -->
    <script>
        const dropzone = document.getElementById("dropzone");
        const fileInput = document.getElementById("file");
        const cleanBtn = document.getElementById("cleanBtn");
        const statusBox = document.getElementById("status");
        const loading = document.getElementById("loading");
        const themeSwitch = document.getElementById("themeSwitch");
        const themeLabel = document.getElementById("themeLabel");

        /* ---------------- Drag and Drop ---------------- */
        dropzone.onclick = () => fileInput.click();

        dropzone.ondragover = e => {
            e.preventDefault();
            dropzone.classList.add("dragover");
        };

        dropzone.ondragleave = () => dropzone.classList.remove("dragover");

        dropzone.ondrop = e => {
            e.preventDefault();
            dropzone.classList.remove("dragover");
            const file = e.dataTransfer.files[0];
            fileInput.files = e.dataTransfer.files;
        };

        /* ---------------- Light / Dark Mode ---------------- */
        themeSwitch.onchange = () => {
            document.body.classList.toggle("dark");
            themeLabel.textContent = document.body.classList.contains("dark")
                ? "Dark Mode"
                : "Light Mode";
        };

        /* ---------------- Handle Upload + Clean ---------------- */
        cleanBtn.onclick = async () => {
            const file = fileInput.files[0];

            if (!file) {
                statusBox.textContent = "Please upload a VTT file first.";
                statusBox.className = "status error";
                return;
            }

            loading.style.display = "block";
            statusBox.textContent = "";
            statusBox.className = "status";

            const formData = new FormData();
            formData.append("file", file);

            try {
                const response = await fetch("/clean", {
                    method: "POST",
                    body: formData
                });

                if (!response.ok) {
                    throw new Error("Server error.");
                }

                const blob = await response.blob();

                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "cleaned.vtt";
                link.click();

                statusBox.textContent = "✔ Cleaning complete! Your download has started.";
                statusBox.className = "status success";
            }
            catch (err) {
                statusBox.textContent = "❌ Error cleaning file.";
                statusBox.className = "status error";
            }
            finally {
                loading.style.display = "none";
            }
        };
    </script>

</body>
</html>
