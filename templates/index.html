<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VTT Cleaner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header>
    VTT Cleaner
</header>

<main>
    <div class="container">
        <h2>Upload your VTT file</h2>
        <form id="upload-form" enctype="multipart/form-data">
            <input type="file" name="file" id="file-input" accept=".vtt" required>
            <button type="submit">Clean Transcript</button>
        </form>

        <div id="status-message"></div>
    </div>
</main>

<script>
document.getElementById("upload-form").addEventListener("submit", async function(e){
    e.preventDefault();
    const fileInput = document.getElementById("file-input");
    const status = document.getElementById("status-message");

    if (!fileInput.files.length) {
        status.textContent = "Please select a file!";
        status.className = "error";
        return;
    }

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    status.textContent = "Cleaning...";
    status.className = "";

    try {
        const response = await fetch("/clean", {
            method: "POST",
            body: formData
        });

        if (!response.ok) throw new Error("Cleaning failed");

        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "cleaned_" + fileInput.files[0].name;
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

        status.textContent = "✔ Cleaning complete!";
        status.className = "success";
    } catch (err) {
        console.error(err);
        status.textContent = "❌ Error cleaning file.";
        status.className = "error";
    }
});
</script>
</body>
</html>
